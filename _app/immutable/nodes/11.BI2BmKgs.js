import{s as Ne,n as ge,r as je}from"../chunks/tX34NKkc.js";import{S as qe,i as ze,d,m as Be,r as Se,q as ue,a as q,b as r,p as ee,u as Fe,c as s,e as u,f as y,j as D,h as M,z as Ee,k as c,l as P,g as He,t as Ae,s as Oe,F as me,G as be}from"../chunks/C0-Udht3.js";import{e as Ie}from"../chunks/D6YF6ztN.js";import{g as Ue}from"../chunks/CwY_kUUy.js";function Te(a,e,t){const l=a.slice();return l[16]=e[t],l}function De(a){let e,t=a[16].label+"",l,i,f,g,o;function p(){return a[11](a[16])}return{c(){e=c("button"),l=Ae(t),i=P(),this.h()},l(k){e=u(k,"BUTTON",{type:!0,class:!0});var m=y(e);l=He(m,t),i=M(m),m.forEach(d),this.h()},h(){s(e,"type","button"),s(e,"class",f="relative h-12 rounded-xl text-center transition-all duration-200 "+(a[3]===a[16].value.toString()?"bg-blue-600 text-white font-medium shadow-lg scale-105":"bg-gray-50 text-gray-600 hover:bg-gray-100"))},m(k,m){q(k,e,m),r(e,l),r(e,i),g||(o=ee(e,"click",p),g=!0)},p(k,m){a=k,m&8&&f!==(f="relative h-12 rounded-xl text-center transition-all duration-200 "+(a[3]===a[16].value.toString()?"bg-blue-600 text-white font-medium shadow-lg scale-105":"bg-gray-50 text-gray-600 hover:bg-gray-100"))&&s(e,"class",f)},d(k){k&&d(e),g=!1,o()}}}function Ve(a){let e,t;return{c(){e=c("div"),t=Ae(a[2]),this.h()},l(l){e=u(l,"DIV",{class:!0});var i=y(e);t=He(i,a[2]),i.forEach(d),this.h()},h(){s(e,"class","bg-red-50 text-red-600 p-4 rounded-xl text-sm")},m(l,i){q(l,e,i),r(e,t)},p(l,i){i&4&&Oe(t,l[2])},d(l){l&&d(e)}}}function Re(a){let e,t="Pay with M-Pesa";return{c(){e=c("span"),e.textContent=t,this.h()},l(l){e=u(l,"SPAN",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-165xu2f"&&(e.textContent=t),this.h()},h(){s(e,"class","font-medium")},m(l,i){q(l,e,i)},d(l){l&&d(e)}}}function Ke(a){let e,t,l,i,f,g="Processing...";return{c(){e=be("svg"),t=be("circle"),l=be("path"),i=P(),f=c("span"),f.textContent=g,this.h()},l(o){e=me(o,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var p=y(e);t=me(p,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),y(t).forEach(d),l=me(p,"path",{class:!0,fill:!0,d:!0}),y(l).forEach(d),p.forEach(d),i=M(o),f=u(o,"SPAN",{"data-svelte-h":!0}),D(f)!=="svelte-ex5vez"&&(f.textContent=g),this.h()},h(){s(t,"class","opacity-25"),s(t,"cx","12"),s(t,"cy","12"),s(t,"r","10"),s(t,"stroke","currentColor"),s(t,"stroke-width","4"),s(l,"class","opacity-75"),s(l,"fill","currentColor"),s(l,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),s(e,"class","animate-spin h-5 w-5"),s(e,"xmlns","http://www.w3.org/2000/svg"),s(e,"fill","none"),s(e,"viewBox","0 0 24 24")},m(o,p){q(o,e,p),r(e,t),r(e,l),q(o,i,p),q(o,f,p)},d(o){o&&(d(e),d(i),d(f))}}}function Le(a){let e,t,l,i,f='<svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',g,o,p="Payment Initiated!",k,m,V="Please check your phone for the M-Pesa prompt and enter your PIN to complete the donation.",_,b,L="Close",B,F;return{c(){e=c("div"),t=c("div"),l=c("div"),i=c("div"),i.innerHTML=f,g=P(),o=c("h3"),o.textContent=p,k=P(),m=c("p"),m.textContent=V,_=P(),b=c("button"),b.textContent=L,this.h()},l(T){e=u(T,"DIV",{class:!0});var A=y(e);t=u(A,"DIV",{class:!0});var v=y(t);l=u(v,"DIV",{class:!0});var h=y(l);i=u(h,"DIV",{class:!0,"data-svelte-h":!0}),D(i)!=="svelte-iw02p6"&&(i.innerHTML=f),g=M(h),o=u(h,"H3",{class:!0,"data-svelte-h":!0}),D(o)!=="svelte-1t07v3t"&&(o.textContent=p),k=M(h),m=u(h,"P",{class:!0,"data-svelte-h":!0}),D(m)!=="svelte-yf1541"&&(m.textContent=V),_=M(h),b=u(h,"BUTTON",{class:!0,"data-svelte-h":!0}),D(b)!=="svelte-bitcc5"&&(b.textContent=L),h.forEach(d),v.forEach(d),A.forEach(d),this.h()},h(){s(i,"class","mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6"),s(o,"class","text-2xl font-bold text-gray-900 mb-2"),s(m,"class","text-gray-600 mb-6"),s(b,"class","w-full inline-flex justify-center px-6 py-3 text-lg font-medium text-blue-600 hover:text-blue-500 transition-colors"),s(l,"class","text-center"),s(t,"class","bg-white rounded-2xl p-8 max-w-md w-full transform transition-all duration-200"),s(e,"class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50")},m(T,A){q(T,e,A),r(e,t),r(t,l),r(l,i),r(l,g),r(l,o),r(l,k),r(l,m),r(l,_),r(l,b),B||(F=ee(b,"click",a[10]),B=!0)},p:ge,d(T){T&&d(e),B=!1,F()}}}function We(a){let e,t,l='<div class="absolute inset-0 bg-hero-pattern bg-cover bg-center bg-fixed"></div> <div class="absolute inset-0 bg-black/30"></div>',i,f,g,o,p,k=`<h1 class="text-3xl font-bold text-gray-800 mb-3">Make a Donation</h1> <p class="text-gray-600 max-w-xl mx-auto">Your contribution helps create positive change in communities.
            Make a secure donation through M-Pesa.</p>`,m,V,_,b,L,B="Amount (KES)",F,T,A,v,h,R,S,K='<span class="text-gray-500 font-medium">KES</span>',J,N,W,_e='<div class="flex items-center space-x-4"><img src="/images/mpesa-logo.png" alt="M-Pesa Logo" class="h-10"/> <div class="hidden sm:block text-sm text-gray-600">Secure Mobile Payment</div></div> <div class="flex items-center space-x-2 text-green-600"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg> <span class="text-sm font-medium">Secure</span></div>',ce,O,H,de,Y,xe='<span class="text-gray-500 font-medium">+254</span>',fe,G,ye='<svg class="h-5 w-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>You&#39;ll receive a payment prompt on your phone. Enter your M-Pesa PIN to complete the donation.</span>',he,se,j,le,re,Q,pe,ke,X=Ie(a[6]),C=[];for(let n=0;n<X.length;n+=1)C[n]=De(Te(a,X,n));let E=a[2]&&Ve(a);function we(n,w){return n[1]?Ke:Re}let ae=we(a),z=ae(a),I=a[5]&&Le(a);return{c(){e=c("div"),t=c("div"),t.innerHTML=l,i=P(),f=c("div"),g=c("div"),o=c("div"),p=c("div"),p.innerHTML=k,m=P(),V=c("div"),_=c("form"),b=c("div"),L=c("label"),L.textContent=B,F=P(),T=c("div");for(let n=0;n<C.length;n+=1)C[n].c();A=P(),v=c("div"),h=c("input"),R=P(),S=c("div"),S.innerHTML=K,J=P(),N=c("div"),W=c("div"),W.innerHTML=_e,ce=P(),O=c("div"),H=c("input"),de=P(),Y=c("div"),Y.innerHTML=xe,fe=P(),G=c("p"),G.innerHTML=ye,he=P(),E&&E.c(),se=P(),j=c("button"),z.c(),re=P(),I&&I.c(),Q=Ee(),this.h()},l(n){e=u(n,"DIV",{class:!0});var w=y(e);t=u(w,"DIV",{class:!0,"data-svelte-h":!0}),D(t)!=="svelte-vqnl64"&&(t.innerHTML=l),i=M(w),f=u(w,"DIV",{class:!0});var x=y(f);g=u(x,"DIV",{class:!0});var te=y(g);o=u(te,"DIV",{class:!0});var ne=y(o);p=u(ne,"DIV",{class:!0,"data-svelte-h":!0}),D(p)!=="svelte-193xecq"&&(p.innerHTML=k),m=M(ne),V=u(ne,"DIV",{class:!0});var Ce=y(V);_=u(Ce,"FORM",{class:!0});var U=y(_);b=u(U,"DIV",{class:!0});var Z=y(b);L=u(Z,"LABEL",{class:!0,"data-svelte-h":!0}),D(L)!=="svelte-qagidu"&&(L.textContent=B),F=M(Z),T=u(Z,"DIV",{class:!0});var Me=y(T);for(let ve=0;ve<C.length;ve+=1)C[ve].l(Me);Me.forEach(d),A=M(Z),v=u(Z,"DIV",{class:!0});var oe=y(v);h=u(oe,"INPUT",{type:!0,class:!0,placeholder:!0,min:!0}),R=M(oe),S=u(oe,"DIV",{class:!0,"data-svelte-h":!0}),D(S)!=="svelte-vo5bb3"&&(S.innerHTML=K),oe.forEach(d),Z.forEach(d),J=M(U),N=u(U,"DIV",{class:!0});var $=y(N);W=u($,"DIV",{class:!0,"data-svelte-h":!0}),D(W)!=="svelte-a7vsrp"&&(W.innerHTML=_e),ce=M($),O=u($,"DIV",{class:!0});var ie=y(O);H=u(ie,"INPUT",{type:!0,class:!0,placeholder:!0,pattern:!0}),de=M(ie),Y=u(ie,"DIV",{class:!0,"data-svelte-h":!0}),D(Y)!=="svelte-a8b6ie"&&(Y.innerHTML=xe),ie.forEach(d),fe=M($),G=u($,"P",{class:!0,"data-svelte-h":!0}),D(G)!=="svelte-qoq85i"&&(G.innerHTML=ye),$.forEach(d),he=M(U),E&&E.l(U),se=M(U),j=u(U,"BUTTON",{type:!0,class:!0});var Pe=y(j);z.l(Pe),Pe.forEach(d),U.forEach(d),Ce.forEach(d),ne.forEach(d),te.forEach(d),x.forEach(d),w.forEach(d),re=M(n),I&&I.l(n),Q=Ee(),this.h()},h(){s(t,"class","fixed inset-0 z-0"),s(p,"class","px-8 pt-12 pb-8 text-center"),s(L,"class","block text-sm font-medium text-gray-700"),s(T,"class","grid grid-cols-3 sm:grid-cols-5 gap-2"),s(h,"type","number"),s(h,"class","w-full h-12 pl-16 pr-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800 svelte-7dlrid"),s(h,"placeholder","Custom amount"),s(h,"min","100"),s(S,"class","absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none"),s(v,"class","relative mt-4"),s(b,"class","space-y-3"),s(W,"class","flex items-center justify-between"),s(H,"type","tel"),H.required=!0,s(H,"class","w-full h-12 pl-20 pr-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800"),s(H,"placeholder","712 345 678"),s(H,"pattern","[0-9]9"),s(Y,"class","absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none"),s(O,"class","relative"),s(G,"class","text-sm text-gray-500 flex items-start space-x-2"),s(N,"class","bg-gradient-to-r from-red-50 to-white rounded-xl p-6 space-y-4"),s(j,"type","submit"),s(j,"class","w-full h-14 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"),j.disabled=le=a[1]||!a[3]&&!a[4]||!a[0],s(_,"class","space-y-8"),s(V,"class","px-8 pb-12"),s(o,"class","bg-white/95 backdrop-blur-sm rounded-[2rem] shadow-2xl overflow-hidden border border-gray-100"),s(g,"class","max-w-3xl mx-auto"),s(f,"class","relative z-10 py-16 px-4 sm:px-6 lg:px-8"),s(e,"class","min-h-screen relative")},m(n,w){q(n,e,w),r(e,t),r(e,i),r(e,f),r(f,g),r(g,o),r(o,p),r(o,m),r(o,V),r(V,_),r(_,b),r(b,L),r(b,F),r(b,T);for(let x=0;x<C.length;x+=1)C[x]&&C[x].m(T,null);r(b,A),r(b,v),r(v,h),ue(h,a[4]),r(v,R),r(v,S),r(_,J),r(_,N),r(N,W),r(N,ce),r(N,O),r(O,H),ue(H,a[0]),r(O,de),r(O,Y),r(N,fe),r(N,G),r(_,he),E&&E.m(_,null),r(_,se),r(_,j),z.m(j,null),q(n,re,w),I&&I.m(n,w),q(n,Q,w),pe||(ke=[ee(h,"input",a[12]),ee(h,"input",a[8]),ee(H,"input",a[13]),ee(_,"submit",Fe(a[9]))],pe=!0)},p(n,[w]){if(w&200){X=Ie(n[6]);let x;for(x=0;x<X.length;x+=1){const te=Te(n,X,x);C[x]?C[x].p(te,w):(C[x]=De(te),C[x].c(),C[x].m(T,null))}for(;x<C.length;x+=1)C[x].d(1);C.length=X.length}w&16&&Se(h.value)!==n[4]&&ue(h,n[4]),w&1&&ue(H,n[0]),n[2]?E?E.p(n,w):(E=Ve(n),E.c(),E.m(_,se)):E&&(E.d(1),E=null),ae!==(ae=we(n))&&(z.d(1),z=ae(n),z&&(z.c(),z.m(j,null))),w&27&&le!==(le=n[1]||!n[3]&&!n[4]||!n[0])&&(j.disabled=le),n[5]?I?I.p(n,w):(I=Le(n),I.c(),I.m(Q.parentNode,Q)):I&&(I.d(1),I=null)},i:ge,o:ge,d(n){n&&(d(e),d(re),d(Q)),Be(C,n),E&&E.d(),z.d(),I&&I.d(n),pe=!1,je(ke)}}}function Ye(a){return/^(?:254|\+254|0)?([71](?:(?:[0-9][0-9])|(?:0[0-8]))[0-9]{6})$/.test(a)}function Ge(a){const e=a.replace(/\D/g,"");return e.startsWith("0")?"254"+e.slice(1):e.startsWith("254")?e:"254"+e}function Je(a,e,t){let l="",i=!1,f="",g="",o="",p="",k=!1;const m=[{value:500,label:"500"},{value:1e3,label:"1,000"},{value:2500,label:"2,500"},{value:5e3,label:"5,000"},{value:1e4,label:"10,000"}];function V(v){t(3,o=v.toString()),t(4,p="")}function _(v){t(3,o=""),t(4,p=v.target.value)}async function b(){const v=o||p;if(!v||!l){t(2,f="Please fill in all required fields");return}if(!Ye(l)){t(2,f="Please enter a valid Kenyan phone number");return}t(1,i=!0),t(2,f=""),g="";try{const h=await fetch("/api/mpesa/stkpush",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(v),phoneNumber:Ge(l)})});if(!h.ok){const S=await h.json();throw new Error(S.error||"Failed to process payment")}const R=await h.json();g="Please check your phone for the M-Pesa prompt to complete the payment.",t(5,k=!0),L(R.checkoutRequestId)}catch(h){t(2,f=h.message||"Failed to process payment. Please try again.")}finally{t(1,i=!1)}}async function L(v){let R=0;const S=async()=>{try{const K=await fetch(`/api/mpesa/status/${v}`);if(!K.ok)throw new Error("Failed to check payment status");const J=await K.json();if(J.status==="COMPLETED"){Ue("/thank-you");return}if(J.status==="FAILED"){t(2,f="Payment failed. Please try again.");return}++R<10&&setTimeout(S,5e3)}catch(K){console.error("Error checking payment status:",K)}};S()}function B(){t(5,k=!1)}const F=v=>V(v.value);function T(){p=Se(this.value),t(4,p)}function A(){l=this.value,t(0,l)}return[l,i,f,o,p,k,m,V,_,b,B,F,T,A]}class et extends qe{constructor(e){super(),ze(this,e,Je,We,Ne,{})}}export{et as component};
